#!/usr/bin/bash
cockroach sql --insecure --execute="DROP DATABASE IF EXISTS wholesale;" --execute="CREATE DATABASE wholesale;" --execute="DROP TABLE IF EXISTS warehouse;" --execute="DROP TABLE IF EXISTS district;" --execute="DROP TABLE IF EXISTS customer;" --execute="DROP TABLE IF EXISTS orders;" --execute="DROP TABLE IF EXISTS item;" --execute="DROP TABLE IF EXISTS orederLine;" --execute="DROP TABLE IF EXISTS stock;" --execute="SET DATABASE=wholesale" --execute="IMPORT TABLE  warehouse (W_ID INT PRIMARY KEY, W_NAME VARCHAR(10), W_STREET_1 VARCHAR(20), W_STREET_2 VARCHAR(20), W_CITY VARCHAR(20), W_STATE CHAR(2), W_ZIP CHAR(9), W_TAX DECIMAL(4,4), W_YTD DECIMAL(12,2)) CSV DATA('nodelocal://1/warehouse.csv');" --execute="CREATE TABLE IF NOT EXISTS district (D_W_ID INT, D_ID INT, D_NAME VARCHAR(10), D_STREET_1 VARCHAR(20), D_STREET_2 VARCHAR(20), D_CITY VARCHAR(20), D_STATE CHAR(2), D_ZIP CHAR(9), D_TAX DECIMAL(4,4), D_YTD DECIMAL(12,2), D_NEXT_O_ID INT, PRIMARY KEY(D_W_ID, D_ID)); IMPORT INTO district CSV DATA('nodelocal://1/district.csv'); ALTER TABLE district ADD CONSTRAINT fk_warehouse FOREIGN KEY(D_W_ID) REFERENCES warehouse(W_ID); ALTER TABLE district VALIDATE CONSTRAINT fk_warehouse;" --execute="CREATE TABLE IF NOT EXISTS customer (C_W_ID INT, C_D_ID INT, C_ID INT, C_FIRST VARCHAR(16), C_MIDDLE CHAR(2), C_LAST VARCHAR(16), C_STREET_1 VARCHAR(20), C_STREET_2 VARCHAR(20), C_CITY VARCHAR(20), C_STATE CHAR(2), C_ZIP CHAR(9), C_PHONE CHAR(16), C_SINCE TIMESTAMP, C_CREDIT CHAR(2), C_CREDIT_LIM DECIMAL(12,2), C_DISCOUNT DECIMAL(4,4), C_BALANCE DECIMAL(12,2), C_YTD_PAYMENT FLOAT, C_PAYMENT_CNT INT, C_DELIVERY_CNT INT, C_DATA VARCHAR(500), PRIMARY KEY(C_W_ID, C_D_ID, C_ID)); IMPORT INTO customer CSV DATA('nodelocal://1/customer.csv'); ALTER TABLE customer ADD CONSTRAINT fk_district FOREIGN KEY (C_W_ID, C_D_ID) REFERENCES district(D_W_ID, D_ID); ALTER TABLE customer VALIDATE CONSTRAINT fk_district;" --execute="CREATE TABLE IF NOT EXISTS orders (O_W_ID INT, O_D_ID INT, O_ID INT, O_C_ID INT, O_CARRRIER_ID INT, O_OL_CNT DECIMAL(2,0), O_ALL_LOCAL DECIMAL(1,0), O_ENTRY_D TIMESTAMP, PRIMARY KEY(O_W_ID, O_D_ID, O_ID), CONSTRAINT fk_customer FOREIGN KEY (O_W_ID, O_D_ID, O_C_ID) REFERENCES customer(C_W_ID, C_D_ID, C_ID)); IMPORT INTO orders CSV DATA('nodelocal://1/order.csv') WITH NULLIF='null'; ALTER TABLE orders VALIDATE CONSTRAINT fk_customer;" --execute="CREATE TABLE IF NOT EXISTS item (I_ID INT PRIMARY KEY, I_NAME VARCHAR(24), I_PRICE DECIMAL(5,2), I_IM_ID INT, I_DATA VARCHAR(50)); IMPORT INTO item CSV DATA('nodelocal://1/item.csv') WITH NULLIF='null';" --execute="CREATE TABLE IF NOT EXISTS orderLine (OL_W_ID INT, OL_D_ID INT, OL_O_ID INT, OL_NUMBER INT, OL_I_ID INT, OL_DELIVERY_D TIMESTAMP, OL_AMOUNT DECIMAL(6,2), OL_SUPPLY_W_ID INT, OL_QUANTITY DECIMAL(2,0), OL_DIST_INFO CHAR(24), PRIMARY KEY(OL_W_ID, OL_D_ID, OL_O_ID, OL_NUMBER), CONSTRAINT fk_order FOREIGN KEY(OL_W_ID, OL_D_ID, OL_O_ID) REFERENCES orders(O_W_ID, O_D_ID, O_ID), CONSTRAINT fk_item FOREIGN KEY(OL_I_ID) REFERENCES item(I_ID)); IMPORT INTO orderLine CSV DATA('nodelocal://1/order-line.csv') WITH NULLIF='null'; ALTER TABLE orderLine VALIDATE CONSTRAINT fk_order; ALTER TABLE orderLine VALIDATE CONSTRAINT fk_item;" --execute="CREATE TABLE IF NOT EXISTS stock (S_W_ID INT, S_I_ID INT, S_QUANTITY DECIMAL(4,0), S_YTD DECIMAL(8,2), S_ORDER_CNT INT, S_REMOTE_CNT INT, S_DIST_01 CHAR(24), S_DIST_02 CHAR(24), S_DIST_03 CHAR(24), S_DIST_04 CHAR(24), S_DIST_05 CHAR(24), S_DIST_06 CHAR(24), S_DIST_07 CHAR(24), S_DIST_08 CHAR(24), S_DIST_09 CHAR(24), S_DIST_10 CHAR(24), S_DATA VARCHAR(50), PRIMARY KEY(S_W_ID, S_I_ID), CONSTRAINT fk_warehouse FOREIGN KEY(S_W_ID) REFERENCES warehouse(W_ID), CONSTRAINT fk_item FOREIGN KEY(S_I_ID) REFERENCES item(I_ID)); IMPORT INTO stock CSV DATA('nodelocal://1/stock.csv') WITH NULLIF='null'; ALTER TABLE stock VALIDATE CONSTRAINT fk_warehouse; ALTER TABLE orderLine VALIDATE CONSTRAINT fk_item;"
